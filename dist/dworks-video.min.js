/*!
 * @name dworks-video
 * @version v1.1.0
 * @author Choi Sunki <sk@daltan.net>
 * @description Operational Video Engine for DALTAN WORKS
 * @repository https://github.com/choisunki/dworks
 * @license MIT
 * @preserve
 */
"use strict";var DWorksVideo=(()=>{var G=Object.defineProperty;var ae=Object.getOwnPropertyDescriptor;var ie=Object.getOwnPropertyNames;var le=Object.prototype.hasOwnProperty;var ue=(t,r)=>{for(var e in r)G(t,e,{get:r[e],enumerable:!0})},ce=(t,r,e,o)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of ie(r))!le.call(t,n)&&n!==e&&G(t,n,{get:()=>r[n],enumerable:!(o=ae(r,n))||o.enumerable});return t};var de=t=>ce(G({},"__esModule",{value:!0}),t);var me={};ue(me,{calcAspectPad:()=>H,controlVideo:()=>g,create:()=>ee,default:()=>be,icons:()=>b,vdoTag:()=>S});var h=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:{};function j(t,r){t=t||{},r=r||{};for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(t[e]=r[e]);return t}function P(t,r){try{return(r||document).querySelector(t)}catch(e){return null}}function Z(t,r){try{return(r||document).querySelectorAll(t)}catch(e){return[]}}function W(t){return t&&t.tagName==="VIDEO"}function Y(t,r,e){r=r||{};try{var o=e&&e.name?e.name:"Error",n=e&&e.message?e.message:String(e||"");console.warn("[DWorksVideo] \uC7AC\uC0DD \uC2E4\uD328:",o,n)}catch(u){}if(r.log)try{console.info("[DWorksVideo][debug] play-blocked detail:",{video:t,error:e||null})}catch(u){}if(typeof r.onPlaybackBlocked=="function")try{r.onPlaybackBlocked({video:t,error:e||null,reason:"play_blocked"})}catch(u){}if(typeof h.CustomEvent=="function")try{var i=new CustomEvent("dworks-video:play-blocked",{detail:{video:t,error:e||null,reason:"play_blocked"}});document.dispatchEvent(i)}catch(u){}}function R(t){if(t){var r=document.getElementById(t);if(W(r)){var e=!!r.muted,o=Z('.ctrl[data-target="'+t+'"]');if(!(!o||!o.length))for(var n=0;n<o.length;n++){var i=o[n];i.classList&&(e?i.classList.add("muted"):i.classList.remove("muted"));try{i.setAttribute("aria-label","\uBE44\uB514\uC624 \uBCFC\uB968 \uC81C\uC5B4")}catch(k){}var u=i.querySelector(".vctrl-volume-off"),_=i.querySelector(".vctrl-volume-on"),m=i.querySelector(".vctrl-status");if(u)try{u.setAttribute("aria-hidden",String(!e)),u.setAttribute("tabindex",e?"0":"-1")}catch(k){}if(_)try{_.setAttribute("aria-hidden",String(e)),_.setAttribute("tabindex",e?"-1":"0")}catch(k){}m&&(m.textContent=e?"\uD604\uC7AC \uC74C\uC18C\uAC70 \uC0C1\uD0DC":"\uD604\uC7AC \uBCFC\uB968 \uCF1C\uC9D0 \uC0C1\uD0DC")}}}}function z(t){var r=Z(".vdo__wrap .video");if(!(!r||!r.length))for(var e=0;e<r.length;e++){var o=r[e];if(W(o)&&!(t&&o.id===t)){try{o.muted=!0}catch(n){}o.id&&R(o.id)}}}function se(t,r){if(typeof h.CustomEvent=="function")try{var e=new CustomEvent("dworks-media:unmute",{detail:{kind:t,id:r||""}});document.dispatchEvent(e)}catch(o){}}function $(t,r,e){if(t){var o=document.getElementById(t);if(W(o)){var n=!e||e.exclusiveAudio!==!1;r&&n&&(z(t),se("video",t)),o.muted=!r,r&&o.paused&&g(o,!0,e),R(t)}}}var s={bound:!1,refs:0,handler:null},f={bound:!1,refs:0,handler:null},v={bound:!1,refs:0,handler:null};function fe(){if(s.bound){s.refs+=1;return}s.handler=function(t){var r=t.target&&t.target.closest?t.target.closest(".ctrl .vctrl"):null;if(r){t.preventDefault&&t.preventDefault();var e=r.closest?r.closest(".ctrl"):null;if(e){var o=e.getAttribute("data-target"),n=r.getAttribute("data-action");o&&$(o,n==="unmute")}}},document.addEventListener("click",s.handler,!1),s.bound=!0,s.refs=1}function ve(){if(s.bound&&(s.refs-=1,!(s.refs>0))){try{document.removeEventListener("click",s.handler,!1)}catch(t){}s.handler=null,s.bound=!1,s.refs=0}}function pe(t,r){if(t){var e=P(".vdo__wrap .video#"+t);if(e){var o=e.closest?e.closest(".vdo__wrap"):null;if(o){var n=o.querySelector(".vdo__tap-indicator");if(n){if(n._hideTimer){try{clearTimeout(n._hideTimer)}catch(i){}n._hideTimer=null}n.classList.remove("show");try{n.offsetWidth}catch(i){}n.classList.remove("is-play"),n.classList.remove("is-pause"),n.classList.add(r?"is-play":"is-pause"),n.classList.add("show"),n._hideTimer=setTimeout(function(){n.classList.remove("show"),n._hideTimer=null},640)}}}}}function _e(){if(f.bound){f.refs+=1;return}f.handler=function(t){var r=t.target;if(!(!r||!r.closest)&&!r.closest(".ctrl")){var e=r.closest(".vdo__wrap .video");if(!(!e||!W(e))){var o=e.closest?e.closest(".vdo__wrap"):null;if(o&&o.getAttribute("data-click-toggle")==="1"){var n=!!(e.paused||e.ended);g(e,n),e.id&&pe(e.id,n)}}}},document.addEventListener("click",f.handler,!1),f.bound=!0,f.refs=1}function ge(){if(f.bound&&(f.refs-=1,!(f.refs>0))){try{document.removeEventListener("click",f.handler,!1)}catch(t){}f.handler=null,f.bound=!1,f.refs=0}}function ye(){if(v.bound){v.refs+=1;return}v.handler=function(t){var r=t&&t.detail?t.detail:{},e=r.kind||"",o=r.id||"";if(e==="video"){z(o);return}e==="youtube"&&z("")},document.addEventListener("dworks-media:unmute",v.handler,!1),v.bound=!0,v.refs=1}function he(){if(v.bound&&(v.refs-=1,!(v.refs>0))){try{document.removeEventListener("dworks-media:unmute",v.handler,!1)}catch(t){}v.handler=null,v.bound=!1,v.refs=0}}function H(t){var r="56.25%",e=String(t||"16/9"),o=e.match(/^\s*(\d+(?:\.\d+)?)\s*\/\s*(\d+(?:\.\d+)?)\s*$/);if(!o)return r;var n=parseFloat(o[1]),i=parseFloat(o[2]);if(!isFinite(n)||!isFinite(i)||n<=0||i<=0)return r;var u=i/n*100;return!isFinite(u)||u<=0?r:u.toFixed(2)+"%"}function g(t,r,e){if(t){if(r){if(!t.paused&&!t.ended)return;try{var o=t.play();o&&typeof o.catch=="function"&&o.catch(function(n){Y(t,e,n)})}catch(n){Y(t,e,n)}return}try{t.paused||t.pause()}catch(n){}}}var b={volume_on:['<svg class="ico ico-volume-on" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">','  <path d="M11 5L6.5 9H3v6h3.5L11 19V5z" fill="currentColor"/>','  <path d="M14.5 8.5a1 1 0 0 1 1.4-.1 6 6 0 0 1 0 7.2 1 1 0 1 1-1.5-1.2 4 4 0 0 0 0-4.8 1 1 0 0 1 .1-1.1z" fill="currentColor"/>','  <path d="M16.8 6.2a1 1 0 0 1 1.4-.1 9 9 0 0 1 0 11.8 1 1 0 1 1-1.5-1.2 7 7 0 0 0 0-9.2 1 1 0 0 1 .1-1.3z" fill="currentColor"/>',"</svg>"].join(""),volume_off:['<svg class="ico ico-volume-off" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">','  <path d="M11 5L6.5 9H3v6h3.5L11 19V5z" fill="currentColor"/>','  <path d="M14.2 9.2a1 1 0 0 1 1.4 0l1.8 1.8 1.8-1.8a1 1 0 1 1 1.4 1.4L18.8 12l1.8 1.8a1 1 0 1 1-1.4 1.4L17.4 13.4l-1.8 1.8a1 1 0 1 1-1.4-1.4L16 12l-1.8-1.8a1 1 0 0 1 0-1z" fill="currentColor"/>',"</svg>"].join("")};function S(t,r,e){var o={vid:"",controls:!1,muted:!0,autoplay:!0,playsinline:!0,loop:!0,vctrl:!0,click_toggle:!1,preload:r&&(r.play_on_enter||r.pause_on_leave)?"metadata":"auto",wrapClass:"vdo__wrap",a11yLabel:"\uBE0C\uB79C\uB4DC \uC601\uC0C1",ratio:"16/9",fit:"cover",poster:""},n=j(j({},o),r||{});e=e||b;var i=String(n.ratio||"16/9"),u=H(i);i.match(/^\s*(\d+(?:\.\d+)?)\s*\/\s*(\d+(?:\.\d+)?)\s*$/)||(i="16/9",u="56.25%");var _=String(n.fit||"cover").toLowerCase();_!=="contain"&&(_="cover");var m="--ar:"+i+";--ar-pad:"+u+";--fit:"+_+";",k=n.click_toggle?' data-click-toggle="1"':"";n.vctrl&&!n.vid&&(n.vid="vdo_"+new Date().getTime()+"_"+Math.floor(Math.random()*1e5));var E=[n.vid?'id="'+n.vid+'"':"",'src="'+t+'"',n.preload?'preload="'+n.preload+'"':"",n.poster?'poster="'+n.poster+'"':"",n.controls?"controls":"",n.muted?"muted":"",n.autoplay?"autoplay":"",n.loop?"loop":"","playsinline","webkit-playsinline"].filter(function(c){return c!==""}).join(" "),T="";if(n.vctrl){var A=n.muted?" muted":"",a=n.vid;T=['<div class="ctrl'+A+'" data-target="'+a+'" role="group" aria-label="\uBE44\uB514\uC624 \uBCFC\uB968 \uC81C\uC5B4">','  <button type="button" class="vctrl vctrl-volume-off" data-action="unmute" aria-label="\uBCFC\uB968 \uCF1C\uAE30" aria-controls="'+a+'">','    <span class="vctrl-popover" role="tooltip">\uBCFC\uB968 \uCF1C\uAE30</span>',e.volume_on||"ON","  </button>",'  <button type="button" class="vctrl vctrl-volume-on" data-action="mute" aria-label="\uBCFC\uB968 \uB044\uAE30" aria-controls="'+a+'">','    <span class="vctrl-popover" role="tooltip">\uBCFC\uB968 \uB044\uAE30</span>',e.volume_off||"OFF","  </button>",'  <span class="sr-only vctrl-status" aria-live="polite" aria-atomic="true"></span>',"</div>"].join("")}return['<div class="'+n.wrapClass+'" style="'+m+'"'+k+">",'  <span class="vdo__spacer" aria-hidden="true"></span>',"  <video "+E+' class="video" aria-label="'+n.a11yLabel+'"></video>',n.click_toggle?'  <span class="vdo__tap-indicator" aria-hidden="true"><span class="vdo__tap-icon vdo__tap-icon-play"></span><span class="vdo__tap-icon vdo__tap-icon-pause"><span class="bar"></span><span class="bar"></span></span></span>':"",T,"</div>"].join("")}function ee(t){var r=j({vdos:[],icons:null,log:!1,exclusiveAudio:!0,viewportChecker:null},t||{}),e={_vctrlBound:!1,_clickToggleBound:!1,_mediaBusBound:!1,_vdoObserver:null,_vdoMap:null};function o(){if(r.log)try{console.info.apply(console,arguments)}catch(a){}}function n(a,c){if(r.log)try{console.info(a,c)}catch(d){}}function i(a,c){try{console.error(a)}catch(d){}!r.log||typeof c=="undefined"||n("[DWorksVideo][debug] detail:",c)}function u(a){R(a)}function _(a,c){$(a,c,{log:r.log,exclusiveAudio:r.exclusiveAudio,onPlaybackBlocked:r.onPlaybackBlocked})}function m(){e._vctrlBound||(e._vctrlBound=!0,fe())}function k(a){if(!(!a||!a.length)){var c=typeof h.IntersectionObserver=="function";if(!c){var d=r.viewportChecker;if(!d||!d.enabled||!d.$)return;for(var l=d.$,x=d.pluginName||"viewportChecker",w=0;w<a.length;w++){var p=a[w];if(!(!p||!p.mount)&&!(!p.play_on_enter&&!p.pause_on_leave)){var O=p.observe||p.mount,I=l(O),K=l(p.mount);if(!(!I.length||!K.length)){var X=K.find("video").first();X.length&&(function(C,B,V){try{l(C)[x]({repeat:!0,callbackFunction:function(L,D){D==="add"?V.play_on_enter&&g(B,!0,{log:r.log,onPlaybackBlocked:r.onPlaybackBlocked}):V.pause_on_leave&&g(B,!1)}})}catch(L){}})(I.get(0),X.get(0),p)}}}return}if(e._vdoObserver){try{e._vdoObserver.disconnect()}catch(C){}e._vdoObserver=null}e._vdoMap=new WeakMap;var re=[0,.01,.1,.25,.35,.5,.75,1],U=new IntersectionObserver(function(C){for(var B=0;B<C.length;B++){var V=C[B],L=e._vdoMap.get(V.target);if(L){var D=L.videoEl,M=L.opt||{},ne=typeof M.view_threshold=="number"?M.view_threshold:.35,oe=V.isIntersecting&&V.intersectionRatio>=ne;oe?M.play_on_enter&&g(D,!0,{log:r.log,onPlaybackBlocked:r.onPlaybackBlocked}):M.pause_on_leave&&g(D,!1)}}},{threshold:re});e._vdoObserver=U;for(var q=0;q<a.length;q++){var y=a[q];if(!(!y||!y.mount)&&!(!y.play_on_enter&&!y.pause_on_leave)){var te=y.observe||y.mount,F=P(te);if(F){var J=P(y.mount);if(J){var Q=J.querySelector("video");Q&&(e._vdoMap.set(F,{videoEl:Q,opt:y}),U.observe(F))}}}}}}function E(){for(var a=r.vdos||[],c=r.icons||b,d=0;d<a.length;d++){var l=a[d];if(!(!l||!l.mount)){var x=l.url;if(!x){i("[DWorksVideo] \uBE44\uB514\uC624 \uACBD\uB85C(url)\uAC00 \uB204\uB77D\uB418\uC5C8\uC2B5\uB2C8\uB2E4. index: "+d,{index:d,item:l});continue}var w=S(x,l,c);if(l.vctrl!==!1&&!l.vid)try{var p=String(w||"").match(/<video\s+[^>]*id=\"([^\"]+)\"/i);p&&p[1]&&(l.vid=p[1])}catch(I){}var O=P(l.mount);O?O.innerHTML=w:i("[DWorksVideo] \uC5D8\uB9AC\uBA3C\uD2B8\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4. mount: "+l.mount,{index:d,mount:l.mount,item:l}),l.vid&&u(l.vid)}}return m(),e._clickToggleBound||(_e(),e._clickToggleBound=!0),e._mediaBusBound||(ye(),e._mediaBusBound=!0),k(a),o("[DWorksVideo] init ok"),A}function T(){if(e._vdoObserver){try{e._vdoObserver.disconnect()}catch(a){}e._vdoObserver=null}e._vdoMap=null,e._vctrlBound&&ve(),e._vctrlBound=!1,e._clickToggleBound&&ge(),e._clickToggleBound=!1,e._mediaBusBound&&he(),e._mediaBusBound=!1,o("[DWorksVideo] destroy ok")}var A={init:E,destroy:T,vdoVolume:_,syncVctrlA11y:u,controlVideo:g,vdoTag:function(a,c){return S(a,c,r.icons||b)},icons:r.icons||b};return A}var N={create:ee,controlVideo:g,vdoTag:function(t,r){return S(t,r,b)},icons:b,calcAspectPad:H};typeof h.__DWORKS_EXPORT__=="function"&&h.__DWORKS_EXPORT__(N);typeof h.window!="undefined"&&(h.DWorksVideo=h.DWorksVideo||N);var be=N;return de(me);})();
/*! dworks-video.js | ES5 | exporter handshake: window.__DWORKS_EXPORT__(mod) */
//# sourceMappingURL=dworks-video.min.js.map
