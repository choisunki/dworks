/*!
 * DWorks Media Bridge v1.1.0
 */
(function(d){var y=d.daltan=d.daltan||{},l=y.works=y.works||{};l.ensure=l.ensure||function(i,o){var r=o||l;return String(i||"").split(".").filter(Boolean).reduce(function(e,u){return e[u]=e[u]||{},e[u]},r)};var t=l.ensure("state"),n=l.ensure("api"),a=l.ensure("utils"),b={init:function(i){t._mediaBridgeInited||(this.config=i||l.config||{},this.setupState(),this.setupUtils(),this.setupMediaRuntime(),this.setupBridge(),this.setupFallback(),t._mediaBridgeInited=!0)},getConfig:function(){return l.config||this.config||{}},setupState:function(){typeof t._vctrlDocBound=="undefined"&&(t._vctrlDocBound=!1),typeof t._videoInstInited=="undefined"&&(t._videoInstInited=!1),typeof t._youtubeInstInited=="undefined"&&(t._youtubeInstInited=!1),typeof t._vdoIdSeq!="number"&&(t._vdoIdSeq=0),t._vdoUsedIds=t._vdoUsedIds||{},typeof t._vdoRetryTimer=="undefined"&&(t._vdoRetryTimer=null),typeof t._vdoMountObserver=="undefined"&&(t._vdoMountObserver=null),typeof t._vdoMountObserverTimer=="undefined"&&(t._vdoMountObserverTimer=null),t.modules=t.modules||{}},setupUtils:function(){var i=this;a.reserveVideoId=a.reserveVideoId||function(o){o&&(t._vdoUsedIds[String(o)]=!0)},a.nextVideoId=a.nextVideoId||function(o){var r=o||"daltan_vdo",e="",u=0;do if(t._vdoIdSeq+=1,e=r+"_"+t._vdoIdSeq,u+=1,u>1e5){e=r+"_"+new Date().getTime()+"_"+u;break}while(t._vdoUsedIds[e]||document.getElementById(e));return t._vdoUsedIds[e]=!0,e},a.markAutoplayBlocked=a.markAutoplayBlocked||function(o,r){if(o){var e=null,u=i.getConfig();try{e=o.closest?o.closest(".vdo__wrap"):null}catch(c){e=null}try{o.setAttribute("data-autoplay-blocked","true")}catch(c){}if(e){try{e.setAttribute("data-autoplay-blocked","true")}catch(c){}try{e.classList&&e.classList.add("is-autoplay-blocked")}catch(c){}}if(u&&u.debug)try{console.warn("[daltan] autoplay blocked",o.id||"(no-id)",r)}catch(c){}try{var s={vid:o.id||"",errorName:r&&r.name?r.name:""},f;typeof d.CustomEvent=="function"?f=new CustomEvent("daltan:autoplay-blocked",{detail:s}):(f=document.createEvent("CustomEvent"),f.initCustomEvent("daltan:autoplay-blocked",!0,!0,s)),document.dispatchEvent(f)}catch(c){}try{u&&typeof u.onPlayFailed=="function"&&u.onPlayFailed({vid:o.id||"",errorName:r&&r.name?r.name:"",error:r||null,videoEl:o})}catch(c){}}},a.clearAutoplayBlocked=a.clearAutoplayBlocked||function(o){if(o){var r=null;try{r=o.closest?o.closest(".vdo__wrap"):null}catch(e){r=null}try{o.removeAttribute("data-autoplay-blocked")}catch(e){}if(r){try{r.removeAttribute("data-autoplay-blocked")}catch(e){}try{r.classList&&r.classList.remove("is-autoplay-blocked")}catch(e){}}}},a.installPlayGuard=a.installPlayGuard||function(o){if(!(!o||o.__daltanPlayGuarded)&&typeof o.play=="function"){var r=o.play;o.__daltanRawPlay=r,o.play=function(){var e;try{e=r.call(o)}catch(u){throw a.markAutoplayBlocked(o,u),u}return e&&typeof e.then=="function"?e.then(function(u){return a.clearAutoplayBlocked(o),u}).catch(function(u){throw a.markAutoplayBlocked(o,u),u}):e},o.__daltanPlayGuarded=!0}}},setupMediaRuntime:function(){n.hasConfigList=n.hasConfigList||function(i){var o=l.config||{},r=o[i];return!!(r&&r.length)},n.normalizeVdos=n.normalizeVdos||function(i){if(!i||!i.length)return[];for(var o=0;o<i.length;o++){var r=i[o];r&&(!r.url&&r.code&&(r.url=r.code),!r.code&&r.url&&(r.code=r.url))}return i},n.getVdoList=n.getVdoList||function(){var i=l.config||{},o=i.vdos;return!o||!o.length?[]:n.normalizeVdos(o)},n.resolveVideos=n.resolveVideos||function(i){var o=[];try{o=typeof i=="function"?i()||[]:[]}catch(r){o=[]}return!o||!o.length?null:o},n.installPlayGuards=n.installPlayGuards||function(i){var o=i||document,r=null;try{r=o.querySelectorAll("video")}catch(u){r=null}if(!(!r||!r.length))for(var e=0;e<r.length;e++)a.installPlayGuard(r[e])},n.retryPendingVideos=n.retryPendingVideos||function(i,o){var r=l.config||{};if(!(!i||!i.length)){var e=20,u=typeof o=="number"?o+1:1;if(u>e){if(r&&r.debug)try{console.warn("[daltan] mount not found after retries",i)}catch(s){}return}if(t._vdoRetryTimer){try{clearTimeout(t._vdoRetryTimer)}catch(s){}t._vdoRetryTimer=null}t._vdoRetryTimer=setTimeout(function(){t._vdoRetryTimer=null;for(var s=[],f=0;f<i.length;f++){var c=i[f];!c||!c.mount||document.querySelector(c.mount)||s.push(c)}typeof n.manageVideos=="function"&&n.manageVideos(),s.length&&n.retryPendingVideos(s,u)},150)}},n.observePendingMounts=n.observePendingMounts||function(i){if(!(!i||!i.length)){if(typeof d.MutationObserver!="function"){n.retryPendingVideos(i,0);return}if(t._vdoMountObserver){try{t._vdoMountObserver.disconnect()}catch(r){}t._vdoMountObserver=null}if(t._vdoMountObserverTimer){try{clearTimeout(t._vdoMountObserverTimer)}catch(r){}t._vdoMountObserverTimer=null}var o=new MutationObserver(function(){for(var r=[],e=0;e<i.length;e++){var u=i[e];!u||!u.mount||document.querySelector(u.mount)||r.push(u)}if(r.length!==i.length&&typeof n.manageVideos=="function"&&n.manageVideos(),!r.length){try{o.disconnect()}catch(s){}if(t._vdoMountObserver=null,t._vdoMountObserverTimer){try{clearTimeout(t._vdoMountObserverTimer)}catch(s){}t._vdoMountObserverTimer=null}return}i=r});try{o.observe(document.documentElement||document.body,{childList:!0,subtree:!0}),t._vdoMountObserver=o}catch(r){t._vdoMountObserver=null,n.retryPendingVideos(i,0);return}t._vdoMountObserverTimer=setTimeout(function(){if(t._vdoMountObserver){try{t._vdoMountObserver.disconnect()}catch(r){}t._vdoMountObserver=null}t._vdoMountObserverTimer=null,n.retryPendingVideos(i,0)},5e3)}},n.manageVideos=n.manageVideos||function(){if(t.modules&&t.modules.videoInst&&typeof t.modules.videoInst.init=="function"){if(!t._videoInstInited)try{t.modules.videoInst.init(),t._videoInstInited=!0,n.installPlayGuards(document)}catch(v){console.warn("[daltan] videoInst.init failed",v)}return}var i=n.resolveVideos(n.getVdoList);if(i&&typeof a.vdoTag=="function"){for(var o=[],r=0;r<i.length;r++){var e=i[r];if(!(!e||!e.code||!e.mount)&&!e._mountedDone){if(!document.querySelector(e.mount)){o.push(e);continue}e.vctrl!==!1&&!e.vid?e.vid=a.nextVideoId("daltan_vdo"):e.vid&&a.reserveVideoId(e.vid);var u=a.vdoTag(e.code,e);if(e.vctrl!==!1)try{var s=String(u||"").match(/<video\s+[^>]*id=\"([^\"]+)\"/i);s&&s[1]&&(e.vid=s[1],a.reserveVideoId(e.vid))}catch(v){}if(d.jQuery)d.jQuery(e.mount).html(u);else{var f=document.querySelector(e.mount);f&&(f.innerHTML=u)}try{var c=document.querySelector(e.mount);c&&n.installPlayGuards(c)}catch(v){}e._mountedDone=!0,e.vid&&typeof n.syncVctrlA11y=="function"&&n.syncVctrlA11y(e.vid)}}!t._vctrlDocBound&&typeof n.bindVideoCtrls=="function"&&(n.bindVideoCtrls(),t._vctrlDocBound=!0),typeof n.bindVideoVisibility=="function"&&n.bindVideoVisibility(i),o.length&&n.observePendingMounts(o)}},n.manageTubes=n.manageTubes||function(){if(t.modules&&t.modules.youtubeInst&&typeof t.modules.youtubeInst.init=="function"&&!t._youtubeInstInited)try{t.modules.youtubeInst.init(),t._youtubeInstInited=!0}catch(i){console.warn("[daltan] youtubeInst.init failed",i)}},n.isVideoReady=n.isVideoReady||function(){var i=!!(t.modules&&t.modules.videoInst&&typeof t.modules.videoInst.init=="function");return typeof a.vdoTag=="function"||i},n.isYoutubeReady=n.isYoutubeReady||function(){return!!(t.modules&&t.modules.youtubeInst&&typeof t.modules.youtubeInst.init=="function")},n.initVideos=n.initVideos||function(){n.hasConfigList("vdos")&&(n.isVideoReady&&n.isVideoReady()?typeof n.manageVideos=="function"&&n.manageVideos():console.warn("[daltan] video module not ready"))},n.initTubes=n.initTubes||function(){n.hasConfigList("tubes")&&(n.isYoutubeReady&&n.isYoutubeReady()?typeof n.manageTubes=="function"&&n.manageTubes():console.warn("[daltan] youtube module not ready"))},n.init=n.init||function(){n.initVideos(),n.initTubes()}},createModuleInstance:function(i,o){if(!o||typeof o.create!="function")return null;var r=i==="youtube",e=this.getConfig();try{var u={icons:a.icons||o.icons||null,log:!!e.debug,viewportChecker:{enabled:!0,$:d.jQuery,pluginName:"viewportChecker"}};return r?(u.tubes=e.tubes||[],u.onPlaybackBlocked=function(s){typeof e.onPlayFailed=="function"&&e.onPlayFailed(s||{})}):u.vdos=n.normalizeVdos?n.normalizeVdos(e.vdos||[]):e.vdos||[],o.create(u)}catch(s){return console.error("[daltan] "+i+" instance creation failed",s),null}},setupBridge:function(){var i=this,o=d.__DWORKS_EXPORT__;d.__DWORKS_EXPORT__=function(e){try{var u=!!(e&&e.extractYouTubeId);u?l.assignYoutubeModule(e):l.assignVideoModule(e)}finally{typeof o=="function"&&o(e)}};var r=d.__DWORKS_EXPORT_YOUTUBE__;d.__DWORKS_EXPORT_YOUTUBE__=function(e){try{l.assignYoutubeModule(e)}finally{typeof r=="function"&&r(e)}},l.assignVideoModule=function(e){if(e){t.modules.video=e;var u=i.createModuleInstance("video",e),s=u||e;a.icons=s.icons||e.icons||a.icons,a.controlVideo=s.controlVideo||e.controlVideo||a.controlVideo,a.vdoTag=s.vdoTag||e.vdoTag||a.vdoTag,n.vdoVolume=s.vdoVolume||e.vdoVolume||n.vdoVolume,n.syncVctrlA11y=s.syncVctrlA11y||e.syncVctrlA11y||n.syncVctrlA11y,n.bindVideoCtrls=s.bindVideoCtrls||e.bindVideoCtrls||n.bindVideoCtrls,n.bindVideoVisibility=s.bindVideoVisibility||e.bindVideoVisibility||n.bindVideoVisibility;var f=s.destroy||e.destroy||null;typeof f=="function"&&(n._rawDestroy=f,n.destroy=function(){try{n._rawDestroy()}catch(c){}if(t._vctrlDocBound=!1,t._videoInstInited=!1,t._vdoRetryTimer){try{clearTimeout(t._vdoRetryTimer)}catch(c){}t._vdoRetryTimer=null}if(t._vdoMountObserver){try{t._vdoMountObserver.disconnect()}catch(c){}t._vdoMountObserver=null}if(t._vdoMountObserverTimer){try{clearTimeout(t._vdoMountObserverTimer)}catch(c){}t._vdoMountObserverTimer=null}}),u&&(t.modules.videoInst=u,t._videoInstInited=!1,typeof n.bindVideoCtrls!="function"&&(n.bindVideoCtrls=function(){}),typeof n.bindVideoVisibility!="function"&&(n.bindVideoVisibility=function(){}))}},l.assignYoutubeModule=function(e){if(e){t.modules.youtube=e;var u=i.createModuleInstance("youtube",e);u&&(t.modules.youtubeInst=u,t._youtubeInstInited=!1)}}},setupFallback:function(){var i=n.assignFallbackModules||function(){};n.assignFallbackModules=function(){i.call(n);var o=d.DWorksVideo||d.DWORKS_VIDEO||d.dworksVideo||d.dworks_video||null,r=d.DWorksYoutube||d.DWORKS_YOUTUBE||d.dworksYoutube||d.dworks_youtube||null;!o&&d.dworks&&d.dworks.video&&(o=d.dworks.video),!r&&d.dworks&&d.dworks.youtube&&(r=d.dworks.youtube),o&&!t.modules.video&&l.assignVideoModule(o),r&&!t.modules.youtube&&l.assignYoutubeModule(r)}}};d.DWorksMediaBridge=b})(window);
//# sourceMappingURL=dworks-media-bridge.esm.min.js.map
