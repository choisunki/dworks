/*!
 * @name dworks-youtube
 * @version v1.1.0
 * @author Choi Sunki <sk@daltan.net>
 * @description Operational Youtube Engine for DALTAN WORKS
 * @repository https://github.com/choisunki/dworks
 * @license MIT
 * @preserve
 */
var u=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:{};function D(r,e){r=r||{},e=e||{};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r}function H(r,e){try{return(e||document).querySelector(r)}catch(t){return null}}function ee(r,e){try{return(e||document).querySelectorAll(r)}catch(t){return[]}}function Z(r){var e="56.25%",t=String(r||"16/9"),o=t.match(/^\s*(\d+(?:\.\d+)?)\s*\/\s*(\d+(?:\.\d+)?)\s*$/);if(!o)return e;var l=parseFloat(o[1]),i=parseFloat(o[2]);if(!isFinite(l)||!isFinite(i)||l<=0||i<=0)return e;var c=i/l*100;return!isFinite(c)||c<=0?e:c.toFixed(2)+"%"}function G(r){if(!r)return"";var e=String(r).trim();if(!e)return"";if(/^[a-zA-Z0-9_-]{11}$/.test(e))return e;for(var t=[/(?:youtube\.com\/watch\?v=|youtube\.com\/shorts\/|youtube\.com\/embed\/|youtu\.be\/)([a-zA-Z0-9_-]{11})/,/[?&]v=([a-zA-Z0-9_-]{11})/],o=0;o<t.length;o++){var l=e.match(t[o]);if(l&&l[1])return l[1]}return""}function te(){try{var r=u&&u.daltan&&u.daltan.works&&u.daltan.works.config&&u.daltan.works.config.tubes;return Array.isArray(r)?r:[]}catch(e){return[]}}var C={volume_on:['<svg class="ico ico-volume-on" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">','  <path d="M11 5L6.5 9H3v6h3.5L11 19V5z" fill="currentColor"/>','  <path d="M14.5 8.5a1 1 0 0 1 1.4-.1 6 6 0 0 1 0 7.2 1 1 0 1 1-1.5-1.2 4 4 0 0 0 0-4.8 1 1 0 0 1 .1-1.1z" fill="currentColor"/>','  <path d="M16.8 6.2a1 1 0 0 1 1.4-.1 9 9 0 0 1 0 11.8 1 1 0 1 1-1.5-1.2 7 7 0 0 0 0-9.2 1 1 0 0 1 .1-1.3z" fill="currentColor"/>',"</svg>"].join(""),volume_off:['<svg class="ico ico-volume-off" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">','  <path d="M11 5L6.5 9H3v6h3.5L11 19V5z" fill="currentColor"/>','  <path d="M14.2 9.2a1 1 0 0 1 1.4 0l1.8 1.8 1.8-1.8a1 1 0 1 1 1.4 1.4L18.8 12l1.8 1.8a1 1 0 1 1-1.4 1.4L17.4 13.4l-1.8 1.8a1 1 0 1 1-1.4-1.4L16 12l-1.8-1.8a1 1 0 0 1 0-1z" fill="currentColor"/>',"</svg>"].join("")},B=u.__DWORKS_YT_REGISTRY__||{};u.__DWORKS_YT_REGISTRY__=B;function j(r){return r&&B[r]||null}function F(r){for(var e in B)if(Object.prototype.hasOwnProperty.call(B,e)&&e!==r){var t=B[e];if(t){try{typeof t.mute=="function"&&t.mute()}catch(o){}P(e,!0)}}}function re(r,e){if(typeof u.CustomEvent=="function")try{var t=new CustomEvent("dworks-media:unmute",{detail:{kind:r,id:e||""}});document.dispatchEvent(t)}catch(o){}}function $(r,e,t){e=e||{};try{console.warn("[DWorksYoutube] \uC7AC\uC0DD \uC2E4\uD328:",t||"play_blocked")}catch(o){}if(e.log)try{console.info("[DWorksYoutube][debug] play-blocked detail:",{id:r,error:t||null})}catch(o){}if(typeof e.onPlaybackBlocked=="function")try{e.onPlaybackBlocked({player:r,error:t||null,reason:"play_blocked"})}catch(o){}}function oe(r){if(!r||typeof r.isMuted!="function")return!0;try{return!!r.isMuted()}catch(e){return!0}}function P(r,e){if(r){var t=j(r);if(t){var o=typeof e=="boolean"?e:oe(t),l=ee('.ctrl[data-target="'+r+'"]');if(!(!l||!l.length))for(var i=0;i<l.length;i++){var c=l[i];c.classList&&(o?c.classList.add("muted"):c.classList.remove("muted"));try{c.setAttribute("aria-label","\uC720\uD29C\uBE0C \uBCFC\uB968 \uC81C\uC5B4")}catch(T){}var g=c.querySelector(".vctrl-volume-off"),I=c.querySelector(".vctrl-volume-on"),Y=c.querySelector(".vctrl-status");if(g)try{g.setAttribute("aria-hidden",String(!o)),g.setAttribute("tabindex",o?"0":"-1")}catch(T){}if(I)try{I.setAttribute("aria-hidden",String(o)),I.setAttribute("tabindex",o?"-1":"0")}catch(T){}Y&&(Y.textContent=o?"\uD604\uC7AC \uC74C\uC18C\uAC70 \uC0C1\uD0DC":"\uD604\uC7AC \uBCFC\uB968 \uCF1C\uC9D0 \uC0C1\uD0DC")}}}}function w(r,e,t){var o=r;if(typeof r=="string"&&(o=j(r)),!!o){if(e){try{typeof o.playVideo=="function"&&o.playVideo()}catch(l){$(r,t,l)}return}try{typeof o.pauseVideo=="function"&&o.pauseVideo()}catch(l){}}}function q(r,e,t){var o=j(r);if(o){var l=!e,i=!t||t.exclusiveAudio!==!1;try{e?(i&&F(r),i&&re("youtube",r),typeof o.unMute=="function"&&o.unMute(),w(o,!0,t)):typeof o.mute=="function"&&o.mute()}catch(c){}P(r,l),setTimeout(function(){P(r)},80)}}var p={bound:!1,refs:0,handler:null},_={bound:!1,refs:0,handler:null};function ne(){if(p.bound){p.refs+=1;return}p.handler=function(r){var e=r.target&&r.target.closest?r.target.closest(".ctrl .vctrl"):null;if(e){r.preventDefault&&r.preventDefault();var t=e.closest?e.closest(".ctrl"):null;if(t){var o=t.getAttribute("data-target"),l=e.getAttribute("data-action");o&&q(o,l==="unmute")}}},document.addEventListener("click",p.handler,!1),p.bound=!0,p.refs=1}function ae(){if(p.bound&&(p.refs-=1,!(p.refs>0))){try{document.removeEventListener("click",p.handler,!1)}catch(r){}p.handler=null,p.bound=!1,p.refs=0}}function le(){if(_.bound){_.refs+=1;return}_.handler=function(r){var e=r&&r.detail?r.detail:{},t=e.kind||"",o=e.id||"";if(t==="youtube"){F(o);return}t==="video"&&F("")},document.addEventListener("dworks-media:unmute",_.handler,!1),_.bound=!0,_.refs=1}function ue(){if(_.bound&&(_.refs-=1,!(_.refs>0))){try{document.removeEventListener("dworks-media:unmute",_.handler,!1)}catch(r){}_.handler=null,_.bound=!1,_.refs=0}}var v=u.__DWORKS_YT_API_STATE__||{loading:!1,ready:!1,callbacks:[],prevReady:null};u.__DWORKS_YT_API_STATE__=v;function ie(r){if(typeof r=="function"&&v.callbacks.push(r),u.YT&&u.YT.Player){for(v.ready=!0;v.callbacks.length;)try{v.callbacks.shift()()}catch(o){}return}if(!v.loading){v.loading=!0,v.prevReady=typeof u.onYouTubeIframeAPIReady=="function"?u.onYouTubeIframeAPIReady:null,u.onYouTubeIframeAPIReady=function(){if(v.ready=!0,v.loading=!1,typeof v.prevReady=="function")try{v.prevReady()}catch(o){}for(;v.callbacks.length;)try{v.callbacks.shift()()}catch(o){}};var e=document.getElementById("dworks-youtube-iframe-api");if(!e){e=document.createElement("script"),e.id="dworks-youtube-iframe-api",e.src="https://www.youtube.com/iframe_api",e.async=!0;var t=document.getElementsByTagName("script")[0];t&&t.parentNode?t.parentNode.insertBefore(e,t):document.head.appendChild(e)}}}function z(r,e){var t={vid:"",ytId:"",url:"",ratio:"16/9",autoplay:!0,mute:!0,loop:!0,controls:!1,playsinline:!0,rel:0,modestbranding:1,iv_load_policy:3,cc_load_policy:0,disablekb:0,fs:1,start:0,end:0,vctrl:!0,ctrlPosition:"bottom",wrapClass:"vdo__wrap",a11yLabel:"\uBE0C\uB79C\uB4DC \uC720\uD29C\uBE0C \uC601\uC0C1"},o=D(D({},t),r||{});e=e||C;var l=o.ytId||G(o.url);if(!l)return null;o.vid||(o.vid="yt_"+new Date().getTime()+"_"+Math.floor(Math.random()*1e5));var i=o.vid+"__yt",c=String(o.ratio||"16/9"),g=Z(c);c.match(/^\s*(\d+(?:\.\d+)?)\s*\/\s*(\d+(?:\.\d+)?)\s*$/)||(c="16/9",g="56.25%");var I="--ar:"+c+";--ar-pad:"+g+";--fit:cover;",Y=o.mute?" muted":"",T=String(o.ctrlPosition||"bottom").toLowerCase()==="top",S=T?" ctrl--top":" ctrl--bottom",L=T?' style="top:0;bottom:auto;"':"",R="";return o.vctrl&&(R=['<div class="ctrl'+Y+S+'"'+L+' data-target="'+o.vid+'" role="group" aria-label="\uC720\uD29C\uBE0C \uBCFC\uB968 \uC81C\uC5B4">','  <button type="button" class="vctrl vctrl-volume-off" data-action="unmute" aria-label="\uBCFC\uB968 \uCF1C\uAE30" aria-controls="'+i+'">','    <span class="vctrl-popover" role="tooltip">\uBCFC\uB968 \uCF1C\uAE30</span>',e.volume_on||"ON","  </button>",'  <button type="button" class="vctrl vctrl-volume-on" data-action="mute" aria-label="\uBCFC\uB968 \uB044\uAE30" aria-controls="'+i+'">','    <span class="vctrl-popover" role="tooltip">\uBCFC\uB968 \uB044\uAE30</span>',e.volume_off||"OFF","  </button>",'  <span class="sr-only vctrl-status" aria-live="polite" aria-atomic="true"></span>',"</div>"].join("")),{html:['<div class="'+o.wrapClass+'" style="'+I+'">','  <span class="vdo__spacer" aria-hidden="true"></span>','  <div id="'+i+'" class="video yt-player" aria-label="'+o.a11yLabel+'"></div>',R,"</div>"].join(""),vid:o.vid,ytId:l,playerElId:i}}function ce(r){var e=D({tubes:null,icons:null,log:!1,exclusiveAudio:!0,onPlaybackBlocked:null,viewportChecker:null},r||{}),t={_vctrlBound:!1,_mediaBusBound:!1,_vdoObserver:null,_vdoMap:null,_ytMap:{}};function o(){if(e.log)try{console.info.apply(console,arguments)}catch(a){}}function l(a,d){if(e.log)try{console.info(a,d)}catch(n){}}function i(a,d){try{console.error(a)}catch(n){}!e.log||typeof d=="undefined"||l("[DWorksYoutube][debug] detail:",d)}function c(a){P(a)}function g(a,d){q(a,d,{log:e.log,exclusiveAudio:e.exclusiveAudio,onPlaybackBlocked:e.onPlaybackBlocked})}function I(){t._vctrlBound||(t._vctrlBound=!0,ne())}function Y(a){if(!u.YT||!u.YT.Player){i("[DWorksYoutube] YouTube Iframe API\uAC00 \uC900\uBE44\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");return}for(var d=0;d<a.length;d++){var n=a[d];if(!(!n||!n._playerElId||!n._ytId||!n.vid)){var h=!!n.autoplay,s=h?!0:n.mute!==!1,f={autoplay:h?1:0,controls:n.controls?1:0,disablekb:n.disablekb?1:0,fs:n.fs===0?0:1,iv_load_policy:typeof n.iv_load_policy=="number"?n.iv_load_policy:3,cc_load_policy:typeof n.cc_load_policy=="number"?n.cc_load_policy:0,playsinline:n.playsinline===!1?0:1,rel:typeof n.rel=="number"?n.rel:0,modestbranding:typeof n.modestbranding=="number"?n.modestbranding:1,mute:s?1:0,start:typeof n.start=="number"&&n.start>0?n.start:0};typeof n.end=="number"&&n.end>0&&(f.end=n.end),n.loop&&(f.loop=1,f.playlist=n._ytId);var y=new u.YT.Player(n._playerElId,{videoId:n._ytId,playerVars:f,events:{onReady:(function(b){return function(){if(P(b.vid),b.autoplay)try{w(b.vid,!0,{log:e.log,onPlaybackBlocked:e.onPlaybackBlocked})}catch(A){}}})(n),onStateChange:(function(b){return function(){P(b.vid)}})(n),onError:(function(b){return function(A){$(b.vid,{log:e.log,onPlaybackBlocked:e.onPlaybackBlocked},A&&typeof A.data!="undefined"?"YT_ERROR_"+A.data:"YT_ERROR")}})(n)}});t._ytMap[n.vid]=y,B[n.vid]=y}}}function T(a){if(!(!a||!a.length)){var d=typeof u.IntersectionObserver=="function";if(!d){var n=e.viewportChecker;if(!n||!n.enabled||!n.$)return;for(var h=n.$,s=n.pluginName||"viewportChecker",f=0;f<a.length;f++){var y=a[f];if(!(!y||!y.mount)&&!(!y.play_on_enter&&!y.pause_on_leave)){var b=y.observe||y.mount,A=h(b);A.length&&(function(E,m){try{h(E)[s]({repeat:!0,callbackFunction:function(x,M){M==="add"?m.play_on_enter&&w(m.vid,!0,{log:e.log,onPlaybackBlocked:e.onPlaybackBlocked}):m.pause_on_leave&&w(m.vid,!1)}})}catch(x){}})(A.get(0),y)}}return}if(t._vdoObserver){try{t._vdoObserver.disconnect()}catch(E){}t._vdoObserver=null}t._vdoMap=new WeakMap;var X=[0,.01,.1,.25,.35,.5,.75,1],N=new IntersectionObserver(function(E){for(var m=0;m<E.length;m++){var x=E[m],M=t._vdoMap.get(x.target);if(M){var O=M.opt||{},J=typeof O.view_threshold=="number"?O.view_threshold:.35,Q=x.isIntersecting&&x.intersectionRatio>=J;Q?O.play_on_enter&&w(M.id,!0,{log:e.log,onPlaybackBlocked:e.onPlaybackBlocked}):O.pause_on_leave&&w(M.id,!1)}}},{threshold:X});t._vdoObserver=N;for(var V=0;V<a.length;V++){var k=a[V];if(!(!k||!k.mount)&&!(!k.play_on_enter&&!k.pause_on_leave)){var U=k.observe||k.mount,W=H(U);W&&(t._vdoMap.set(W,{id:k.vid,opt:k}),N.observe(W))}}}}function S(){for(var a=Array.isArray(e.tubes)?e.tubes:te(),d=e.icons||C,n=[],h=0;h<a.length;h++){var s=a[h];if(!(!s||!s.mount)){var f=z(s,d);if(!f||!f.ytId){i("[DWorksYoutube] \uBE44\uB514\uC624 \uACBD\uB85C(url) \uB610\uB294 ytId\uAC00 \uB204\uB77D\uB418\uC5C8\uC2B5\uB2C8\uB2E4. index: "+h,{index:h,item:s});continue}var y=H(s.mount);if(!y){i("[DWorksYoutube] \uC5D8\uB9AC\uBA3C\uD2B8\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4. mount: "+s.mount,{index:h,mount:s.mount,item:s});continue}y.innerHTML=f.html,s.vid=f.vid,s._ytId=f.ytId,s._playerElId=f.playerElId,n.push(s)}}return I(),t._mediaBusBound||(le(),t._mediaBusBound=!0),ie(function(){Y(n),T(n);for(var b=0;b<n.length;b++)P(n[b].vid);o("[DWorksYoutube] init ok")}),R}function L(){if(t._vdoObserver){try{t._vdoObserver.disconnect()}catch(d){}t._vdoObserver=null}t._vdoMap=null;for(var a in t._ytMap)if(Object.prototype.hasOwnProperty.call(t._ytMap,a)){try{t._ytMap[a]&&typeof t._ytMap[a].destroy=="function"&&t._ytMap[a].destroy()}catch(d){}delete B[a]}t._ytMap={},t._vctrlBound&&ae(),t._vctrlBound=!1,t._mediaBusBound&&ue(),t._mediaBusBound=!1,o("[DWorksYoutube] destroy ok")}var R={init:S,destroy:L,vdoVolume:g,syncVctrlA11y:c,controlVideo:function(a,d){return w(a,d,{log:e.log,exclusiveAudio:e.exclusiveAudio,onPlaybackBlocked:e.onPlaybackBlocked})},vdoTag:function(a){return z(a,e.icons||C)},extractYouTubeId:G,icons:e.icons||C};return R}function de(r,e){q(r,e,{exclusiveAudio:!0})}var K={create:ce,vdoVolume:de,controlVideo:w,vdoTag:function(r){return z(r,C)},extractYouTubeId:G,icons:C,calcAspectPad:Z};typeof u.__DWORKS_EXPORT__=="function"&&u.__DWORKS_EXPORT__(K);typeof u.window!="undefined"&&(u.DWorksYoutube=u.DWorksYoutube||K);var se=K;export{Z as calcAspectPad,w as controlVideo,ce as create,se as default,G as extractYouTubeId,C as icons,z as vdoTag,de as vdoVolume};
/*! dworks-youtube.js | ES5 | exporter handshake: window.__DWORKS_EXPORT__(mod) */
//# sourceMappingURL=dworks-youtube.esm.min.js.map
