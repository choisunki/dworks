/*!
 * @name dworks-youtube
 * @version v1.1.0
 * @author Choi Sunki <sk@daltan.net>
 * @description Operational Youtube Engine for DALTAN WORKS
 * @repository https://github.com/choisunki/dworks
 * @license MIT
 * @preserve
 */
"use strict";var DWorksYoutube=(()=>{var z=Object.defineProperty;var oe=Object.getOwnPropertyDescriptor;var ne=Object.getOwnPropertyNames;var ae=Object.prototype.hasOwnProperty;var le=(t,e)=>{for(var r in e)z(t,r,{get:e[r],enumerable:!0})},ue=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let l of ne(e))!ae.call(t,l)&&l!==r&&z(t,l,{get:()=>e[l],enumerable:!(o=oe(e,l))||o.enumerable});return t};var ie=t=>ue(z({},"__esModule",{value:!0}),t);var ge={};le(ge,{calcAspectPad:()=>q,controlVideo:()=>g,create:()=>U,default:()=>he,extractYouTubeId:()=>L,icons:()=>B,vdoTag:()=>S,vdoVolume:()=>J});var u=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:{};function G(t,e){t=t||{},e=e||{};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}function $(t,e){try{return(e||document).querySelector(t)}catch(r){return null}}function ce(t,e){try{return(e||document).querySelectorAll(t)}catch(r){return[]}}function q(t){var e="56.25%",r=String(t||"16/9"),o=r.match(/^\s*(\d+(?:\.\d+)?)\s*\/\s*(\d+(?:\.\d+)?)\s*$/);if(!o)return e;var l=parseFloat(o[1]),i=parseFloat(o[2]);if(!isFinite(l)||!isFinite(i)||l<=0||i<=0)return e;var c=i/l*100;return!isFinite(c)||c<=0?e:c.toFixed(2)+"%"}function L(t){if(!t)return"";var e=String(t).trim();if(!e)return"";if(/^[a-zA-Z0-9_-]{11}$/.test(e))return e;for(var r=[/(?:youtube\.com\/watch\?v=|youtube\.com\/shorts\/|youtube\.com\/embed\/|youtu\.be\/)([a-zA-Z0-9_-]{11})/,/[?&]v=([a-zA-Z0-9_-]{11})/],o=0;o<r.length;o++){var l=e.match(r[o]);if(l&&l[1])return l[1]}return""}function de(){try{var t=u&&u.daltan&&u.daltan.works&&u.daltan.works.config&&u.daltan.works.config.tubes;return Array.isArray(t)?t:[]}catch(e){return[]}}var B={volume_on:['<svg class="ico ico-volume-on" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">','  <path d="M11 5L6.5 9H3v6h3.5L11 19V5z" fill="currentColor"/>','  <path d="M14.5 8.5a1 1 0 0 1 1.4-.1 6 6 0 0 1 0 7.2 1 1 0 1 1-1.5-1.2 4 4 0 0 0 0-4.8 1 1 0 0 1 .1-1.1z" fill="currentColor"/>','  <path d="M16.8 6.2a1 1 0 0 1 1.4-.1 9 9 0 0 1 0 11.8 1 1 0 1 1-1.5-1.2 7 7 0 0 0 0-9.2 1 1 0 0 1 .1-1.3z" fill="currentColor"/>',"</svg>"].join(""),volume_off:['<svg class="ico ico-volume-off" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false">','  <path d="M11 5L6.5 9H3v6h3.5L11 19V5z" fill="currentColor"/>','  <path d="M14.2 9.2a1 1 0 0 1 1.4 0l1.8 1.8 1.8-1.8a1 1 0 1 1 1.4 1.4L18.8 12l1.8 1.8a1 1 0 1 1-1.4 1.4L17.4 13.4l-1.8 1.8a1 1 0 1 1-1.4-1.4L16 12l-1.8-1.8a1 1 0 0 1 0-1z" fill="currentColor"/>',"</svg>"].join("")},Y=u.__DWORKS_YT_REGISTRY__||{};u.__DWORKS_YT_REGISTRY__=Y;function K(t){return t&&Y[t]||null}function j(t){for(var e in Y)if(Object.prototype.hasOwnProperty.call(Y,e)&&e!==t){var r=Y[e];if(r){try{typeof r.mute=="function"&&r.mute()}catch(o){}P(e,!0)}}}function se(t,e){if(typeof u.CustomEvent=="function")try{var r=new CustomEvent("dworks-media:unmute",{detail:{kind:t,id:e||""}});document.dispatchEvent(r)}catch(o){}}function X(t,e,r){e=e||{};try{console.warn("[DWorksYoutube] \uC7AC\uC0DD \uC2E4\uD328:",r||"play_blocked")}catch(o){}if(e.log)try{console.info("[DWorksYoutube][debug] play-blocked detail:",{id:t,error:r||null})}catch(o){}if(typeof e.onPlaybackBlocked=="function")try{e.onPlaybackBlocked({player:t,error:r||null,reason:"play_blocked"})}catch(o){}}function fe(t){if(!t||typeof t.isMuted!="function")return!0;try{return!!t.isMuted()}catch(e){return!0}}function P(t,e){if(t){var r=K(t);if(r){var o=typeof e=="boolean"?e:fe(r),l=ce('.ctrl[data-target="'+t+'"]');if(!(!l||!l.length))for(var i=0;i<l.length;i++){var c=l[i];c.classList&&(o?c.classList.add("muted"):c.classList.remove("muted"));try{c.setAttribute("aria-label","\uC720\uD29C\uBE0C \uBCFC\uB968 \uC81C\uC5B4")}catch(T){}var k=c.querySelector(".vctrl-volume-off"),I=c.querySelector(".vctrl-volume-on"),M=c.querySelector(".vctrl-status");if(k)try{k.setAttribute("aria-hidden",String(!o)),k.setAttribute("tabindex",o?"0":"-1")}catch(T){}if(I)try{I.setAttribute("aria-hidden",String(o)),I.setAttribute("tabindex",o?"-1":"0")}catch(T){}M&&(M.textContent=o?"\uD604\uC7AC \uC74C\uC18C\uAC70 \uC0C1\uD0DC":"\uD604\uC7AC \uBCFC\uB968 \uCF1C\uC9D0 \uC0C1\uD0DC")}}}}function g(t,e,r){var o=t;if(typeof t=="string"&&(o=K(t)),!!o){if(e){try{typeof o.playVideo=="function"&&o.playVideo()}catch(l){X(t,r,l)}return}try{typeof o.pauseVideo=="function"&&o.pauseVideo()}catch(l){}}}function N(t,e,r){var o=K(t);if(o){var l=!e,i=!r||r.exclusiveAudio!==!1;try{e?(i&&j(t),i&&se("youtube",t),typeof o.unMute=="function"&&o.unMute(),g(o,!0,r)):typeof o.mute=="function"&&o.mute()}catch(c){}P(t,l),setTimeout(function(){P(t)},80)}}var p={bound:!1,refs:0,handler:null},_={bound:!1,refs:0,handler:null};function ve(){if(p.bound){p.refs+=1;return}p.handler=function(t){var e=t.target&&t.target.closest?t.target.closest(".ctrl .vctrl"):null;if(e){t.preventDefault&&t.preventDefault();var r=e.closest?e.closest(".ctrl"):null;if(r){var o=r.getAttribute("data-target"),l=e.getAttribute("data-action");o&&N(o,l==="unmute")}}},document.addEventListener("click",p.handler,!1),p.bound=!0,p.refs=1}function ye(){if(p.bound&&(p.refs-=1,!(p.refs>0))){try{document.removeEventListener("click",p.handler,!1)}catch(t){}p.handler=null,p.bound=!1,p.refs=0}}function be(){if(_.bound){_.refs+=1;return}_.handler=function(t){var e=t&&t.detail?t.detail:{},r=e.kind||"",o=e.id||"";if(r==="youtube"){j(o);return}r==="video"&&j("")},document.addEventListener("dworks-media:unmute",_.handler,!1),_.bound=!0,_.refs=1}function pe(){if(_.bound&&(_.refs-=1,!(_.refs>0))){try{document.removeEventListener("dworks-media:unmute",_.handler,!1)}catch(t){}_.handler=null,_.bound=!1,_.refs=0}}var v=u.__DWORKS_YT_API_STATE__||{loading:!1,ready:!1,callbacks:[],prevReady:null};u.__DWORKS_YT_API_STATE__=v;function _e(t){if(typeof t=="function"&&v.callbacks.push(t),u.YT&&u.YT.Player){for(v.ready=!0;v.callbacks.length;)try{v.callbacks.shift()()}catch(o){}return}if(!v.loading){v.loading=!0,v.prevReady=typeof u.onYouTubeIframeAPIReady=="function"?u.onYouTubeIframeAPIReady:null,u.onYouTubeIframeAPIReady=function(){if(v.ready=!0,v.loading=!1,typeof v.prevReady=="function")try{v.prevReady()}catch(o){}for(;v.callbacks.length;)try{v.callbacks.shift()()}catch(o){}};var e=document.getElementById("dworks-youtube-iframe-api");if(!e){e=document.createElement("script"),e.id="dworks-youtube-iframe-api",e.src="https://www.youtube.com/iframe_api",e.async=!0;var r=document.getElementsByTagName("script")[0];r&&r.parentNode?r.parentNode.insertBefore(e,r):document.head.appendChild(e)}}}function S(t,e){var r={vid:"",ytId:"",url:"",ratio:"16/9",autoplay:!0,mute:!0,loop:!0,controls:!1,playsinline:!0,rel:0,modestbranding:1,iv_load_policy:3,cc_load_policy:0,disablekb:0,fs:1,start:0,end:0,vctrl:!0,ctrlPosition:"bottom",wrapClass:"vdo__wrap",a11yLabel:"\uBE0C\uB79C\uB4DC \uC720\uD29C\uBE0C \uC601\uC0C1"},o=G(G({},r),t||{});e=e||B;var l=o.ytId||L(o.url);if(!l)return null;o.vid||(o.vid="yt_"+new Date().getTime()+"_"+Math.floor(Math.random()*1e5));var i=o.vid+"__yt",c=String(o.ratio||"16/9"),k=q(c);c.match(/^\s*(\d+(?:\.\d+)?)\s*\/\s*(\d+(?:\.\d+)?)\s*$/)||(c="16/9",k="56.25%");var I="--ar:"+c+";--ar-pad:"+k+";--fit:cover;",M=o.mute?" muted":"",T=String(o.ctrlPosition||"bottom").toLowerCase()==="top",V=T?" ctrl--top":" ctrl--bottom",W=T?' style="top:0;bottom:auto;"':"",R="";return o.vctrl&&(R=['<div class="ctrl'+M+V+'"'+W+' data-target="'+o.vid+'" role="group" aria-label="\uC720\uD29C\uBE0C \uBCFC\uB968 \uC81C\uC5B4">','  <button type="button" class="vctrl vctrl-volume-off" data-action="unmute" aria-label="\uBCFC\uB968 \uCF1C\uAE30" aria-controls="'+i+'">','    <span class="vctrl-popover" role="tooltip">\uBCFC\uB968 \uCF1C\uAE30</span>',e.volume_on||"ON","  </button>",'  <button type="button" class="vctrl vctrl-volume-on" data-action="mute" aria-label="\uBCFC\uB968 \uB044\uAE30" aria-controls="'+i+'">','    <span class="vctrl-popover" role="tooltip">\uBCFC\uB968 \uB044\uAE30</span>',e.volume_off||"OFF","  </button>",'  <span class="sr-only vctrl-status" aria-live="polite" aria-atomic="true"></span>',"</div>"].join("")),{html:['<div class="'+o.wrapClass+'" style="'+I+'">','  <span class="vdo__spacer" aria-hidden="true"></span>','  <div id="'+i+'" class="video yt-player" aria-label="'+o.a11yLabel+'"></div>',R,"</div>"].join(""),vid:o.vid,ytId:l,playerElId:i}}function U(t){var e=G({tubes:null,icons:null,log:!1,exclusiveAudio:!0,onPlaybackBlocked:null,viewportChecker:null},t||{}),r={_vctrlBound:!1,_mediaBusBound:!1,_vdoObserver:null,_vdoMap:null,_ytMap:{}};function o(){if(e.log)try{console.info.apply(console,arguments)}catch(a){}}function l(a,d){if(e.log)try{console.info(a,d)}catch(n){}}function i(a,d){try{console.error(a)}catch(n){}!e.log||typeof d=="undefined"||l("[DWorksYoutube][debug] detail:",d)}function c(a){P(a)}function k(a,d){N(a,d,{log:e.log,exclusiveAudio:e.exclusiveAudio,onPlaybackBlocked:e.onPlaybackBlocked})}function I(){r._vctrlBound||(r._vctrlBound=!0,ve())}function M(a){if(!u.YT||!u.YT.Player){i("[DWorksYoutube] YouTube Iframe API\uAC00 \uC900\uBE44\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4.");return}for(var d=0;d<a.length;d++){var n=a[d];if(!(!n||!n._playerElId||!n._ytId||!n.vid)){var h=!!n.autoplay,s=h?!0:n.mute!==!1,f={autoplay:h?1:0,controls:n.controls?1:0,disablekb:n.disablekb?1:0,fs:n.fs===0?0:1,iv_load_policy:typeof n.iv_load_policy=="number"?n.iv_load_policy:3,cc_load_policy:typeof n.cc_load_policy=="number"?n.cc_load_policy:0,playsinline:n.playsinline===!1?0:1,rel:typeof n.rel=="number"?n.rel:0,modestbranding:typeof n.modestbranding=="number"?n.modestbranding:1,mute:s?1:0,start:typeof n.start=="number"&&n.start>0?n.start:0};typeof n.end=="number"&&n.end>0&&(f.end=n.end),n.loop&&(f.loop=1,f.playlist=n._ytId);var y=new u.YT.Player(n._playerElId,{videoId:n._ytId,playerVars:f,events:{onReady:(function(b){return function(){if(P(b.vid),b.autoplay)try{g(b.vid,!0,{log:e.log,onPlaybackBlocked:e.onPlaybackBlocked})}catch(A){}}})(n),onStateChange:(function(b){return function(){P(b.vid)}})(n),onError:(function(b){return function(A){X(b.vid,{log:e.log,onPlaybackBlocked:e.onPlaybackBlocked},A&&typeof A.data!="undefined"?"YT_ERROR_"+A.data:"YT_ERROR")}})(n)}});r._ytMap[n.vid]=y,Y[n.vid]=y}}}function T(a){if(!(!a||!a.length)){var d=typeof u.IntersectionObserver=="function";if(!d){var n=e.viewportChecker;if(!n||!n.enabled||!n.$)return;for(var h=n.$,s=n.pluginName||"viewportChecker",f=0;f<a.length;f++){var y=a[f];if(!(!y||!y.mount)&&!(!y.play_on_enter&&!y.pause_on_leave)){var b=y.observe||y.mount,A=h(b);A.length&&(function(E,w){try{h(E)[s]({repeat:!0,callbackFunction:function(x,C){C==="add"?w.play_on_enter&&g(w.vid,!0,{log:e.log,onPlaybackBlocked:e.onPlaybackBlocked}):w.pause_on_leave&&g(w.vid,!1)}})}catch(x){}})(A.get(0),y)}}return}if(r._vdoObserver){try{r._vdoObserver.disconnect()}catch(E){}r._vdoObserver=null}r._vdoMap=new WeakMap;var Q=[0,.01,.1,.25,.35,.5,.75,1],Z=new IntersectionObserver(function(E){for(var w=0;w<E.length;w++){var x=E[w],C=r._vdoMap.get(x.target);if(C){var O=C.opt||{},te=typeof O.view_threshold=="number"?O.view_threshold:.35,re=x.isIntersecting&&x.intersectionRatio>=te;re?O.play_on_enter&&g(C.id,!0,{log:e.log,onPlaybackBlocked:e.onPlaybackBlocked}):O.pause_on_leave&&g(C.id,!1)}}},{threshold:Q});r._vdoObserver=Z;for(var D=0;D<a.length;D++){var m=a[D];if(!(!m||!m.mount)&&!(!m.play_on_enter&&!m.pause_on_leave)){var ee=m.observe||m.mount,F=$(ee);F&&(r._vdoMap.set(F,{id:m.vid,opt:m}),Z.observe(F))}}}}function V(){for(var a=Array.isArray(e.tubes)?e.tubes:de(),d=e.icons||B,n=[],h=0;h<a.length;h++){var s=a[h];if(!(!s||!s.mount)){var f=S(s,d);if(!f||!f.ytId){i("[DWorksYoutube] \uBE44\uB514\uC624 \uACBD\uB85C(url) \uB610\uB294 ytId\uAC00 \uB204\uB77D\uB418\uC5C8\uC2B5\uB2C8\uB2E4. index: "+h,{index:h,item:s});continue}var y=$(s.mount);if(!y){i("[DWorksYoutube] \uC5D8\uB9AC\uBA3C\uD2B8\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4. mount: "+s.mount,{index:h,mount:s.mount,item:s});continue}y.innerHTML=f.html,s.vid=f.vid,s._ytId=f.ytId,s._playerElId=f.playerElId,n.push(s)}}return I(),r._mediaBusBound||(be(),r._mediaBusBound=!0),_e(function(){M(n),T(n);for(var b=0;b<n.length;b++)P(n[b].vid);o("[DWorksYoutube] init ok")}),R}function W(){if(r._vdoObserver){try{r._vdoObserver.disconnect()}catch(d){}r._vdoObserver=null}r._vdoMap=null;for(var a in r._ytMap)if(Object.prototype.hasOwnProperty.call(r._ytMap,a)){try{r._ytMap[a]&&typeof r._ytMap[a].destroy=="function"&&r._ytMap[a].destroy()}catch(d){}delete Y[a]}r._ytMap={},r._vctrlBound&&ye(),r._vctrlBound=!1,r._mediaBusBound&&pe(),r._mediaBusBound=!1,o("[DWorksYoutube] destroy ok")}var R={init:V,destroy:W,vdoVolume:k,syncVctrlA11y:c,controlVideo:function(a,d){return g(a,d,{log:e.log,exclusiveAudio:e.exclusiveAudio,onPlaybackBlocked:e.onPlaybackBlocked})},vdoTag:function(a){return S(a,e.icons||B)},extractYouTubeId:L,icons:e.icons||B};return R}function J(t,e){N(t,e,{exclusiveAudio:!0})}var H={create:U,vdoVolume:J,controlVideo:g,vdoTag:function(t){return S(t,B)},extractYouTubeId:L,icons:B,calcAspectPad:q};typeof u.__DWORKS_EXPORT__=="function"&&u.__DWORKS_EXPORT__(H);typeof u.window!="undefined"&&(u.DWorksYoutube=u.DWorksYoutube||H);var he=H;return ie(ge);})();
/*! dworks-youtube.js | ES5 | exporter handshake: window.__DWORKS_EXPORT__(mod) */
//# sourceMappingURL=dworks-youtube.min.js.map
